<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Tuition Balance</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body.dark-mode { background-color:#121212; color:#f5f5f5; }
        .sidebar { height:100vh; background:#343a40; padding-top:20px; position:fixed; width:240px; }
        .sidebar a { display:block; color:#fff; padding:12px; text-decoration:none; }
        .sidebar a:hover { background:#495057; }
        .main-content { margin-left:240px; padding:20px; }
        .card { border-radius:10px; }
        .clock { font-size:0.95rem; font-weight:600; }
        .status-badge { min-width:80px; }
    </style>
</head>
<body>
<div class="d-flex">
    <!-- Sidebar -->
    <div class="sidebar">
        <h4 class="text-center text-white">Student Portal</h4>
        <a th:href="@{/student/dashboard}"><i class="fas fa-home me-2"></i>Dashboard</a>
        <a th:href="@{/student/profile}"><i class="fas fa-user me-2"></i>Profile</a>
        <a th:href="@{/student/grades}"><i class="fas fa-graduation-cap me-2"></i>Grades Viewer</a>
        <a th:href="@{/student/class-schedule}"><i class="fas fa-calendar-alt me-2"></i>Class Schedule</a>
        <a th:href="@{/student/tuition-balance}" class="bg-primary"><i class="fas fa-money-bill me-2"></i>Tuition Balance</a>
        <a th:href="@{/student/academic-calendar}"><i class="fas fa-calendar me-2"></i>Academic Calendar</a>
        <hr class="text-white">
        <div class="text-center">
            <button class="btn btn-sm btn-warning" onclick="toggleDarkMode()">Toggle Dark Mode</button>
        </div>
        <div class="text-center text-white mt-3 clock" id="clock"></div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h2>My Tuition Balance</h2>
                <p class="mb-0">View your assessed fees, outstanding balance, and payment due dates.</p>
            </div>
            <div>
                <a class="btn btn-outline-secondary btn-sm" th:href="@{/student/dashboard}">
                    <i class="fa-solid fa-arrow-left-long"></i> Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="row g-4 mt-2">
            <div class="col-md-4">
                <div class="card shadow-sm p-3 bg-light">
                    <h6 class="text-muted mb-1">Total Tuition Balance</h6>
                    <h3 class="text-primary mb-0"
                        th:text="${totalFees != null ? '₱' + #numbers.formatDecimal(totalFees, 1, 'COMMA', 2, 'POINT') : '₱0.00'}">₱0.00</h3>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm p-3 bg-light">
                    <h6 class="text-muted mb-1">Outstanding Balance</h6>
                    <h3 class="text-danger mb-0"
                        th:text="${outstandingBalance != null ? '₱' + #numbers.formatDecimal(outstandingBalance, 1, 'COMMA', 2, 'POINT') : '₱0.00'}">₱0.00</h3>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm p-3 bg-light">
                    <h6 class="text-muted mb-1">Next Payment Due</h6>
                    <h4 class="text-warning mb-0" th:text="${nextDueDate}">N/A</h4>
                </div>
            </div>
        </div>

        <!-- Payment Schedule -->
        <div class="card shadow-sm mt-4">
            <div class="card-header d-flex align-items-center">
                <i class="fa-regular fa-calendar me-2"></i>
                <strong>Payment Schedule</strong>
            </div>
            <div class="card-body table-responsive">
                <table class="table table-striped align-middle">
                    <thead class="table-dark">
                    <tr>
                        <th>Due Date</th>
                        <th>Amount</th>
                        <th>Paid</th>
                        <th>Paid At</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="p : ${paymentSchedule}">
                        <td th:text="${p.dueDate}">2025-09-01</td>
                        <td th:text="${'₱' + #numbers.formatDecimal(p.amount, 1, 'COMMA', 2, 'POINT')}">₱0.00</td>
                        <td>
                            <span class="badge status-badge"
                                  th:classappend="${p.paid} ? 'bg-success' : 'bg-danger'"
                                  th:text="${p.paid} ? 'Paid' : 'Unpaid'">Unpaid</span>
                        </td>
                        <td th:text="${p.paidAt != null ? #temporals.format(p.paidAt, 'yyyy-MM-dd HH:mm') : '—'}">—</td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(paymentSchedule)}">
                        <td colspan="4" class="text-center text-muted">No payment schedule available.</td>
                    </tr>
                    </tbody>
                </table>
                <p class="small text-muted mb-0">
                    Note: This page is for viewing only. Payments are recorded by the cashier and reflected here automatically.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    function updateClock() {
        const el = document.getElementById('clock');
        const now = new Date();
        el.textContent = now.toLocaleString();
    }
    setInterval(updateClock, 1000); updateClock();

    function toggleDarkMode(){
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
    }
</script>
</body>
</html>
